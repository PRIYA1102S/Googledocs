{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useEffect, useRef, useCallback } from 'react';\nimport { updateDocument } from '../services/documentService';\nconst useAutoSave = (documentId, document, enabled = true) => {\n  _s();\n  const timeoutRef = useRef(null);\n  const lastSavedRef = useRef(null);\n  const isSavingRef = useRef(false);\n  const saveDocument = useCallback(async () => {\n    if (!documentId || !document || isSavingRef.current) {\n      return;\n    }\n\n    // Check if document has actually changed\n    const currentDocString = JSON.stringify(document);\n    if (lastSavedRef.current === currentDocString) {\n      return;\n    }\n\n    // Prevent saving obviously invalid payloads\n    if (!document.title || document.title.trim() === '') {\n      return;\n    }\n    try {\n      isSavingRef.current = true;\n      // Don't use the returned document to avoid state updates that could reset cursor\n      await updateDocument(documentId, document);\n      lastSavedRef.current = currentDocString;\n      console.log('Document auto-saved successfully');\n    } catch (error) {\n      console.error('Auto-save failed:', error);\n    } finally {\n      isSavingRef.current = false;\n    }\n  }, [documentId, document]);\n  const debouncedSave = useCallback(() => {\n    if (!enabled) return;\n    if (timeoutRef.current) {\n      clearTimeout(timeoutRef.current);\n    }\n    timeoutRef.current = setTimeout(() => {\n      saveDocument();\n    }, 2000); // Auto-save after 2 seconds of inactivity\n  }, [saveDocument, enabled]);\n  useEffect(() => {\n    if (enabled && document) {\n      debouncedSave();\n    }\n    return () => {\n      if (timeoutRef.current) {\n        clearTimeout(timeoutRef.current);\n      }\n    };\n  }, [document, debouncedSave, enabled]);\n\n  // Cleanup timers on unmount; do not trigger a save to avoid state update after unmount warnings\n  useEffect(() => {\n    return () => {\n      if (timeoutRef.current) {\n        clearTimeout(timeoutRef.current);\n      }\n    };\n  }, []);\n  const forceSave = useCallback(() => {\n    if (timeoutRef.current) {\n      clearTimeout(timeoutRef.current);\n    }\n    return saveDocument();\n  }, [saveDocument]);\n  return {\n    forceSave,\n    isSaving: isSavingRef.current\n  };\n};\n_s(useAutoSave, \"kwzyfZljcA4uCiLvzP1lt1FAAFc=\");\nexport default useAutoSave;","map":{"version":3,"names":["useEffect","useRef","useCallback","updateDocument","useAutoSave","documentId","document","enabled","_s","timeoutRef","lastSavedRef","isSavingRef","saveDocument","current","currentDocString","JSON","stringify","title","trim","console","log","error","debouncedSave","clearTimeout","setTimeout","forceSave","isSaving"],"sources":["D:/Docs-MERN/google-docs-clone/frontend/src/hooks/useAutoSave.js"],"sourcesContent":["import { useEffect, useRef, useCallback } from 'react';\r\nimport { updateDocument } from '../services/documentService';\r\n\r\nconst useAutoSave = (documentId, document, enabled = true) => {\r\n  const timeoutRef = useRef(null);\r\n  const lastSavedRef = useRef(null);\r\n  const isSavingRef = useRef(false);\r\n\r\n  const saveDocument = useCallback(async () => {\r\n    if (!documentId || !document || isSavingRef.current) {\r\n      return;\r\n    }\r\n\r\n    // Check if document has actually changed\r\n    const currentDocString = JSON.stringify(document);\r\n    if (lastSavedRef.current === currentDocString) {\r\n      return;\r\n    }\r\n\r\n    // Prevent saving obviously invalid payloads\r\n    if (!document.title || document.title.trim() === '') {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      isSavingRef.current = true;\r\n      // Don't use the returned document to avoid state updates that could reset cursor\r\n      await updateDocument(documentId, document);\r\n      lastSavedRef.current = currentDocString;\r\n      console.log('Document auto-saved successfully');\r\n    } catch (error) {\r\n      console.error('Auto-save failed:', error);\r\n    } finally {\r\n      isSavingRef.current = false;\r\n    }\r\n  }, [documentId, document]);\r\n\r\n  const debouncedSave = useCallback(() => {\r\n    if (!enabled) return;\r\n\r\n    if (timeoutRef.current) {\r\n      clearTimeout(timeoutRef.current);\r\n    }\r\n\r\n    timeoutRef.current = setTimeout(() => {\r\n      saveDocument();\r\n    }, 2000); // Auto-save after 2 seconds of inactivity\r\n  }, [saveDocument, enabled]);\r\n\r\n  useEffect(() => {\r\n    if (enabled && document) {\r\n      debouncedSave();\r\n    }\r\n\r\n    return () => {\r\n      if (timeoutRef.current) {\r\n        clearTimeout(timeoutRef.current);\r\n      }\r\n    };\r\n  }, [document, debouncedSave, enabled]);\r\n\r\n  // Cleanup timers on unmount; do not trigger a save to avoid state update after unmount warnings\r\n  useEffect(() => {\r\n    return () => {\r\n      if (timeoutRef.current) {\r\n        clearTimeout(timeoutRef.current);\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  const forceSave = useCallback(() => {\r\n    if (timeoutRef.current) {\r\n      clearTimeout(timeoutRef.current);\r\n    }\r\n    return saveDocument();\r\n  }, [saveDocument]);\r\n\r\n  return {\r\n    forceSave,\r\n    isSaving: isSavingRef.current\r\n  };\r\n};\r\n\r\nexport default useAutoSave;"],"mappings":";AAAA,SAASA,SAAS,EAAEC,MAAM,EAAEC,WAAW,QAAQ,OAAO;AACtD,SAASC,cAAc,QAAQ,6BAA6B;AAE5D,MAAMC,WAAW,GAAGA,CAACC,UAAU,EAAEC,QAAQ,EAAEC,OAAO,GAAG,IAAI,KAAK;EAAAC,EAAA;EAC5D,MAAMC,UAAU,GAAGR,MAAM,CAAC,IAAI,CAAC;EAC/B,MAAMS,YAAY,GAAGT,MAAM,CAAC,IAAI,CAAC;EACjC,MAAMU,WAAW,GAAGV,MAAM,CAAC,KAAK,CAAC;EAEjC,MAAMW,YAAY,GAAGV,WAAW,CAAC,YAAY;IAC3C,IAAI,CAACG,UAAU,IAAI,CAACC,QAAQ,IAAIK,WAAW,CAACE,OAAO,EAAE;MACnD;IACF;;IAEA;IACA,MAAMC,gBAAgB,GAAGC,IAAI,CAACC,SAAS,CAACV,QAAQ,CAAC;IACjD,IAAII,YAAY,CAACG,OAAO,KAAKC,gBAAgB,EAAE;MAC7C;IACF;;IAEA;IACA,IAAI,CAACR,QAAQ,CAACW,KAAK,IAAIX,QAAQ,CAACW,KAAK,CAACC,IAAI,CAAC,CAAC,KAAK,EAAE,EAAE;MACnD;IACF;IAEA,IAAI;MACFP,WAAW,CAACE,OAAO,GAAG,IAAI;MAC1B;MACA,MAAMV,cAAc,CAACE,UAAU,EAAEC,QAAQ,CAAC;MAC1CI,YAAY,CAACG,OAAO,GAAGC,gBAAgB;MACvCK,OAAO,CAACC,GAAG,CAAC,kCAAkC,CAAC;IACjD,CAAC,CAAC,OAAOC,KAAK,EAAE;MACdF,OAAO,CAACE,KAAK,CAAC,mBAAmB,EAAEA,KAAK,CAAC;IAC3C,CAAC,SAAS;MACRV,WAAW,CAACE,OAAO,GAAG,KAAK;IAC7B;EACF,CAAC,EAAE,CAACR,UAAU,EAAEC,QAAQ,CAAC,CAAC;EAE1B,MAAMgB,aAAa,GAAGpB,WAAW,CAAC,MAAM;IACtC,IAAI,CAACK,OAAO,EAAE;IAEd,IAAIE,UAAU,CAACI,OAAO,EAAE;MACtBU,YAAY,CAACd,UAAU,CAACI,OAAO,CAAC;IAClC;IAEAJ,UAAU,CAACI,OAAO,GAAGW,UAAU,CAAC,MAAM;MACpCZ,YAAY,CAAC,CAAC;IAChB,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC;EACZ,CAAC,EAAE,CAACA,YAAY,EAAEL,OAAO,CAAC,CAAC;EAE3BP,SAAS,CAAC,MAAM;IACd,IAAIO,OAAO,IAAID,QAAQ,EAAE;MACvBgB,aAAa,CAAC,CAAC;IACjB;IAEA,OAAO,MAAM;MACX,IAAIb,UAAU,CAACI,OAAO,EAAE;QACtBU,YAAY,CAACd,UAAU,CAACI,OAAO,CAAC;MAClC;IACF,CAAC;EACH,CAAC,EAAE,CAACP,QAAQ,EAAEgB,aAAa,EAAEf,OAAO,CAAC,CAAC;;EAEtC;EACAP,SAAS,CAAC,MAAM;IACd,OAAO,MAAM;MACX,IAAIS,UAAU,CAACI,OAAO,EAAE;QACtBU,YAAY,CAACd,UAAU,CAACI,OAAO,CAAC;MAClC;IACF,CAAC;EACH,CAAC,EAAE,EAAE,CAAC;EAEN,MAAMY,SAAS,GAAGvB,WAAW,CAAC,MAAM;IAClC,IAAIO,UAAU,CAACI,OAAO,EAAE;MACtBU,YAAY,CAACd,UAAU,CAACI,OAAO,CAAC;IAClC;IACA,OAAOD,YAAY,CAAC,CAAC;EACvB,CAAC,EAAE,CAACA,YAAY,CAAC,CAAC;EAElB,OAAO;IACLa,SAAS;IACTC,QAAQ,EAAEf,WAAW,CAACE;EACxB,CAAC;AACH,CAAC;AAACL,EAAA,CA9EIJ,WAAW;AAgFjB,eAAeA,WAAW","ignoreList":[]},"metadata":{},"sourceType":"module"}