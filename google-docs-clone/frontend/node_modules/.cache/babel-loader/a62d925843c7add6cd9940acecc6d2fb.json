{"ast":null,"code":"var _jsxFileName = \"D:\\\\Docs-MERN\\\\google-docs-clone\\\\frontend\\\\src\\\\components\\\\CollaborativeEditor.jsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef, useCallback, useContext } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { getDocument, updateDocument } from '../services/documentService';\nimport { useTheme } from '../contexts/ThemeContext';\nimport useAuth from '../hooks/useAuth';\nimport useSocket from '../hooks/useSocket';\nimport useAutoSave from '../hooks/useAutoSave';\nimport CollaborativeTextElement from './CollaborativeTextElement';\nimport ImageElement from './ImageElement';\nimport { mergeTextContent, hasConflict } from '../utils/conflictResolution';\nimport { AuthContext } from '../contexts/AuthContext';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst colorPalette = ['#ef4444', '#f59e0b', '#10b981', '#3b82f6', '#8b5cf6', '#ec4899', '#14b8a6', '#f97316'];\nconst getColorForUserId = userId => {\n  const colors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7', '#DDA0DD', '#98D8C8'];\n  const hash = userId.split('').reduce((a, b) => {\n    a = (a << 5) - a + b.charCodeAt(0);\n    return a & a;\n  }, 0);\n  return colors[Math.abs(hash) % colors.length];\n};\nconst CollaborativeEditor = ({\n  documentId,\n  isReadOnly = false\n}) => {\n  _s();\n  const {\n    id: paramId\n  } = useParams();\n  const id = documentId || paramId; // Use prop if provided, otherwise use param\n  const navigate = useNavigate();\n  const {\n    isDark\n  } = useTheme();\n  const authContext = useContext(AuthContext);\n\n  // Use authContext.user instead of useAuth\n  const user = authContext.user;\n  const loading = !authContext.isAuthenticated; // or however you track loading in AuthContext\n\n  const [document, setDocument] = useState({\n    title: '',\n    content: []\n  });\n  const [isLoading, setIsLoading] = useState(true);\n  const [connectedUsers, setConnectedUsers] = useState([]);\n  const [isOnline, setIsOnline] = useState(false);\n  const [lastSavedContent, setLastSavedContent] = useState(null);\n  const [hasUnsavedChanges, setHasUnsavedChanges] = useState(false);\n  const [userPermission, setUserPermission] = useState(null);\n  const debounceTimeoutRef = useRef(null);\n  const isRemoteChangeRef = useRef(false);\n  const [remoteSelections, setRemoteSelections] = useState({}); // userId -> { index, length, color, name }\n\n  // Auto-save hook - disable for viewers\n  const canEdit = userPermission === 'owner' || userPermission === 'editor';\n\n  // Callback to reset unsaved changes when auto-save completes\n  const handleAutoSaveSuccess = useCallback(() => {\n    setHasUnsavedChanges(false);\n  }, []);\n  const {\n    forceSave,\n    isSaving\n  } = useAutoSave(id, document, isOnline && canEdit, handleAutoSaveSuccess);\n  useEffect(() => {\n    console.log('ðŸ” User state changed:', {\n      user,\n      userId: (user === null || user === void 0 ? void 0 : user.id) || (user === null || user === void 0 ? void 0 : user._id),\n      userName: (user === null || user === void 0 ? void 0 : user.name) || (user === null || user === void 0 ? void 0 : user.username) || (user === null || user === void 0 ? void 0 : user.email)\n    });\n  }, [user]);\n  useEffect(() => {\n    console.log('ðŸ” Auth Debug:', {\n      user,\n      userKeys: user ? Object.keys(user) : 'no user',\n      userId: user === null || user === void 0 ? void 0 : user.id,\n      userIdAlt: user === null || user === void 0 ? void 0 : user._id,\n      userName: user === null || user === void 0 ? void 0 : user.name,\n      userEmail: user === null || user === void 0 ? void 0 : user.email\n    });\n  }, [user]);\n  useEffect(() => {\n    console.log('ðŸ” User loading state:', {\n      user,\n      loading,\n      isAuthenticated: !!user\n    });\n  }, [user, loading]);\n  useEffect(() => {\n    if (user) {\n      console.log('ðŸ” User object structure:', {\n        user,\n        keys: Object.keys(user),\n        id: user.id,\n        _id: user._id,\n        userId: user.userId,\n        name: user.name,\n        username: user.username,\n        email: user.email\n      });\n    }\n  }, [user]);\n\n  //Socket connection\n  const {\n    emitDocumentChange,\n    emitCursorChange,\n    onDocumentChange,\n    onCursorChange,\n    onUserJoined,\n    onUserLeft,\n    onUsersInDocument,\n    offDocumentChange,\n    offCursorChange,\n    offUserJoined,\n    offUserLeft,\n    offUsersInDocument,\n    isConnected\n  } = useSocket(id, (user === null || user === void 0 ? void 0 : user.id) || (user === null || user === void 0 ? void 0 : user._id), (user === null || user === void 0 ? void 0 : user.name) || (user === null || user === void 0 ? void 0 : user.username) || (user === null || user === void 0 ? void 0 : user.email) || 'Anonymous');\n  console.log('ðŸ”— Socket status:', {\n    isConnected,\n    userId: (user === null || user === void 0 ? void 0 : user.id) || (user === null || user === void 0 ? void 0 : user._id),\n    documentId: id,\n    user: user\n  });\n  useEffect(() => {\n    let isMounted = true;\n    const fetchDocument = async () => {\n      try {\n        const fetchedDocument = await getDocument(id);\n\n        // Normalize content\n        const normalizedContent = Array.isArray(fetchedDocument.content) ? fetchedDocument.content : [{\n          type: 'text',\n          content: fetchedDocument.content || ''\n        }];\n        const documentData = {\n          title: fetchedDocument.title || '',\n          content: normalizedContent\n        };\n        if (!isMounted) return;\n        setDocument(documentData);\n        setLastSavedContent(JSON.stringify(documentData));\n        setUserPermission(fetchedDocument.userPermission);\n        if (!isMounted) return;\n        setIsOnline(true);\n      } catch (error) {\n        console.error('Error fetching document:', error);\n        if (!isMounted) return;\n        setIsOnline(false);\n      } finally {\n        if (!isMounted) return;\n        setIsLoading(false);\n      }\n    };\n    fetchDocument();\n    return () => {\n      isMounted = false;\n    };\n  }, [id]);\n\n  // Set up socket event listeners\n  useEffect(() => {\n    if (!user) return;\n\n    // Handle document changes from other sessions (including same user in another tab)\n    onDocumentChange(({\n      content,\n      userId,\n      userName\n    }) => {\n      isRemoteChangeRef.current = true;\n      setDocument(prevDoc => {\n        // Check for conflicts\n        const currentContent = JSON.stringify(prevDoc.content);\n        const remoteContent = JSON.stringify(content);\n        if (hasConflict(currentContent, remoteContent, lastSavedContent)) {\n          console.warn('Conflict detected - merging changes');\n\n          // Better conflict resolution\n          const mergedContent = mergeTextContent(prevDoc.content, content, lastSavedContent);\n          return {\n            ...prevDoc,\n            content: mergedContent\n          };\n        }\n        return {\n          ...prevDoc,\n          content\n        };\n      });\n    });\n\n    // Remote cursor/selection updates\n    onCursorChange(({\n      userId: remoteUserId,\n      userName: remoteUserName,\n      position,\n      selection\n    }) => {\n      var _ref, _selection$index, _selection$length;\n      console.log('ðŸ“¥ Received cursor change:', {\n        remoteUserId,\n        remoteUserName,\n        position,\n        selection,\n        currentUserId: (user === null || user === void 0 ? void 0 : user.id) || (user === null || user === void 0 ? void 0 : user._id)\n      });\n      if (!remoteUserId || remoteUserId === ((user === null || user === void 0 ? void 0 : user.id) || (user === null || user === void 0 ? void 0 : user._id))) {\n        console.log('âŒ Ignoring cursor change - same user or no userId');\n        return;\n      }\n      const color = getColorForUserId(remoteUserId);\n      const index = (_ref = (_selection$index = selection === null || selection === void 0 ? void 0 : selection.index) !== null && _selection$index !== void 0 ? _selection$index : position) !== null && _ref !== void 0 ? _ref : 0;\n      const length = (_selection$length = selection === null || selection === void 0 ? void 0 : selection.length) !== null && _selection$length !== void 0 ? _selection$length : 0;\n      console.log('âœ… Setting remote selection:', {\n        remoteUserId,\n        index,\n        length,\n        color\n      });\n      setRemoteSelections(prev => ({\n        ...prev,\n        [remoteUserId]: {\n          userId: remoteUserId,\n          name: remoteUserName,\n          color,\n          index,\n          length,\n          updatedAt: Date.now()\n        }\n      }));\n    });\n\n    // Handle user presence\n    onUserJoined(({\n      userId,\n      userName\n    }) => {\n      setConnectedUsers(prev => {\n        const exists = prev.find(u => u.userId === userId);\n        if (!exists) {\n          return [...prev, {\n            userId,\n            userName\n          }];\n        }\n        return prev;\n      });\n    });\n    onUserLeft(({\n      userId,\n      userName\n    }) => {\n      setConnectedUsers(prev => prev.filter(u => u.userId !== userId));\n      setRemoteSelections(prev => {\n        const copy = {\n          ...prev\n        };\n        delete copy[userId];\n        return copy;\n      });\n    });\n    onUsersInDocument(users => {\n      setConnectedUsers(users.filter(u => u.userId !== ((user === null || user === void 0 ? void 0 : user.id) || (user === null || user === void 0 ? void 0 : user._id))));\n    });\n\n    // Cleanup\n    return () => {\n      offDocumentChange();\n      offCursorChange();\n      offUserJoined();\n      offUserLeft();\n      offUsersInDocument();\n    };\n  }, [user, onDocumentChange, onCursorChange, onUserJoined, onUserLeft, onUsersInDocument, offDocumentChange, offCursorChange, offUserJoined, offUserLeft, offUsersInDocument]);\n  const handleChange = updatedContent => {\n    // Prevent viewers from making changes\n    if (userPermission === 'viewer') {\n      console.log('Viewers cannot edit documents');\n      return;\n    }\n    setDocument(prevDoc => ({\n      ...prevDoc,\n      content: updatedContent\n    }));\n    setHasUnsavedChanges(true);\n\n    // Don't emit changes if this was triggered by a remote change\n    if (isRemoteChangeRef.current) {\n      isRemoteChangeRef.current = false;\n      return;\n    }\n\n    // Debounce socket emissions to avoid spam\n    if (debounceTimeoutRef.current) {\n      clearTimeout(debounceTimeoutRef.current);\n    }\n    debounceTimeoutRef.current = setTimeout(() => {\n      emitDocumentChange(null, updatedContent);\n    }, 300);\n  };\n  const handleSave = async () => {\n    // Prevent viewers from saving\n    if (userPermission === 'viewer') {\n      alert('Viewers cannot save documents');\n      return;\n    }\n    try {\n      await forceSave();\n      setLastSavedContent(JSON.stringify(document));\n      setHasUnsavedChanges(false);\n      alert('Document saved successfully!');\n    } catch (error) {\n      console.error('Error saving document:', error);\n      alert('Error saving document');\n    }\n  };\n  const handleImageUpload = async e => {\n    // Prevent viewers from uploading images\n    if (userPermission === 'viewer') {\n      alert('Viewers cannot upload images');\n      return;\n    }\n    const file = e.target.files[0];\n    if (!file) return;\n\n    // Optional: check file size limit (e.g., 5MB)\n    if (file.size > 5 * 1024 * 1024) {\n      alert('Image is too large (max 5MB)');\n      return;\n    }\n    const formData = new FormData();\n    formData.append('image', file);\n    try {\n      const res = await fetch('http://localhost:5000/api/upload-image', {\n        method: 'POST',\n        body: formData\n      });\n      const data = await res.json();\n      if (data.imageUrl) {\n        const newImageBlock = {\n          type: 'image',\n          src: data.imageUrl,\n          alt: file.name\n        };\n        const updatedContent = [...document.content, newImageBlock];\n        handleChange(updatedContent);\n      } else {\n        alert('Upload failed. Try again.');\n      }\n    } catch (error) {\n      console.error('Upload error:', error);\n      alert('Something went wrong during upload.');\n    }\n  };\n  if (isLoading) return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: `flex items-center justify-center min-h-screen ${isDark ? 'text-white' : 'text-gray-800'}`,\n    children: \"Loading...\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 356,\n    columnNumber: 5\n  }, this);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: `p-6 max-w-4xl mx-auto ${isDark ? 'text-white' : 'text-gray-800'}`,\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex justify-between items-center mb-4\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n          className: `text-2xl font-bold ${isDark ? 'text-white' : 'text-gray-800'}`,\n          children: document.title || 'Untitled Document'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 366,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex items-center mt-2 space-x-4\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: `flex items-center space-x-2 ${isConnected ? 'text-green-500' : 'text-red-500'}`,\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: `w-2 h-2 rounded-full ${isConnected ? 'bg-green-500' : 'bg-red-500'}`\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 371,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"text-sm\",\n              children: isConnected ? 'Connected' : 'Disconnected'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 372,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 370,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"text-sm text-gray-500\",\n            children: [\"User: \", (user === null || user === void 0 ? void 0 : user.name) || (user === null || user === void 0 ? void 0 : user.username) || (user === null || user === void 0 ? void 0 : user.email) || 'Not logged in']\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 374,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"text-sm text-gray-500\",\n            children: [\"ID: \", (user === null || user === void 0 ? void 0 : user.id) || (user === null || user === void 0 ? void 0 : user._id) || 'No ID']\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 377,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: `flex items-center space-x-2 text-sm ${isSaving ? 'text-blue-500' : hasUnsavedChanges ? 'text-yellow-500' : 'text-green-500'}`,\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: `w-2 h-2 rounded-full ${isSaving ? 'bg-blue-500 animate-pulse' : hasUnsavedChanges ? 'bg-yellow-500' : 'bg-green-500'}`\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 384,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              children: isSaving ? 'Saving...' : hasUnsavedChanges ? 'Unsaved changes' : 'All changes saved'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 388,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 380,\n            columnNumber: 13\n          }, this), connectedUsers.length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: `text-sm ${isDark ? 'text-gray-300' : 'text-gray-600'}`,\n            children: [connectedUsers.length, \" other\", connectedUsers.length === 1 ? ' user' : ' users', \" editing\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 394,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 369,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 365,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => navigate('/documents'),\n        className: `text-sm px-3 py-1 rounded transition-colors duration-200 ${isDark ? 'bg-gray-700 hover:bg-gray-600 text-white' : 'bg-gray-300 hover:bg-gray-400 text-gray-800'}`,\n        children: \"Back to List\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 400,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 364,\n      columnNumber: 7\n    }, this), connectedUsers.length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: `mb-4 p-3 rounded ${isDark ? 'bg-gray-800 border border-gray-700' : 'bg-blue-50 border border-blue-200'}`,\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: `text-sm font-semibold mb-2 ${isDark ? 'text-white' : 'text-gray-800'}`,\n        children: \"Currently editing:\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 415,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex flex-wrap gap-2\",\n        children: connectedUsers.map(user => /*#__PURE__*/_jsxDEV(\"span\", {\n          className: `px-2 py-1 text-xs rounded-full ${isDark ? 'bg-blue-600 text-white' : 'bg-blue-100 text-blue-800'}`,\n          children: user.userName\n        }, user.userId, false, {\n          fileName: _jsxFileName,\n          lineNumber: 420,\n          columnNumber: 15\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 418,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 414,\n      columnNumber: 9\n    }, this), !isReadOnly && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: `mb-4 p-4 rounded ${isDark ? 'bg-gray-800 border border-gray-700' : 'bg-gray-50 border border-gray-200'}`,\n      children: [/*#__PURE__*/_jsxDEV(\"label\", {\n        className: `block font-semibold mb-1 ${isDark ? 'text-white' : 'text-gray-800'}`,\n        children: \"Add Image\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 439,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"file\",\n        accept: \"image/*\",\n        onChange: handleImageUpload,\n        className: `block w-full text-sm ${isDark ? 'text-gray-300 file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-semibold file:bg-gray-700 file:text-white hover:file:bg-gray-600' : 'text-gray-700 file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100'}`\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 440,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 438,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"space-y-4\",\n      children: document.content.map((element, index) => {\n        if (element.type === 'text') {\n          return /*#__PURE__*/_jsxDEV(CollaborativeTextElement, {\n            content: element.content,\n            isReadOnly: isReadOnly,\n            user: user,\n            remoteSelections: Object.values(remoteSelections),\n            onChange: isReadOnly ? undefined : newContent => {\n              const updatedContent = [...document.content];\n              updatedContent[index].content = newContent;\n              handleChange(updatedContent);\n            },\n            onSelectionChange: selection => {\n              console.log('About to emit cursor change:', {\n                selection,\n                isReadOnly,\n                isConnected,\n                userId: (user === null || user === void 0 ? void 0 : user.id) || (user === null || user === void 0 ? void 0 : user._id)\n              });\n              if (!isReadOnly && selection && isConnected) {\n                emitCursorChange(selection.index, selection);\n              } else {\n                console.log('Not emitting cursor change - conditions not met');\n              }\n            }\n          }, index, false, {\n            fileName: _jsxFileName,\n            lineNumber: 458,\n            columnNumber: 15\n          }, this);\n        } else if (element.type === 'image') {\n          return /*#__PURE__*/_jsxDEV(ImageElement, {\n            src: element.src,\n            alt: element.alt,\n            onDelete: () => {\n              const updatedContent = document.content.filter((_, i) => i !== index);\n              handleChange(updatedContent);\n            }\n          }, index, false, {\n            fileName: _jsxFileName,\n            lineNumber: 486,\n            columnNumber: 15\n          }, this);\n        }\n        return null;\n      })\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 454,\n      columnNumber: 7\n    }, this), !isReadOnly && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"mt-6 flex items-center space-x-4\",\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: handleSave,\n        disabled: isSaving,\n        className: `px-4 py-2 rounded transition-colors duration-200 ${isSaving ? 'bg-gray-400 cursor-not-allowed' : 'bg-blue-500 hover:bg-blue-600'} text-white`,\n        children: isSaving ? 'Saving...' : 'Save Now'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 504,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n        className: `text-sm ${isDark ? 'text-gray-400' : 'text-gray-500'}`,\n        children: \"Changes are auto-saved every 2 seconds\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 515,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 503,\n      columnNumber: 9\n    }, this), isReadOnly && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"mt-6 flex items-center space-x-2\",\n      children: [/*#__PURE__*/_jsxDEV(\"svg\", {\n        className: \"w-5 h-5 text-blue-500\",\n        fill: \"none\",\n        stroke: \"currentColor\",\n        viewBox: \"0 0 24 24\",\n        children: [/*#__PURE__*/_jsxDEV(\"path\", {\n          strokeLinecap: \"round\",\n          strokeLinejoin: \"round\",\n          strokeWidth: 2,\n          d: \"M15 12a3 3 0 11-6 0 3 3 0 016 0z\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 525,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"path\", {\n          strokeLinecap: \"round\",\n          strokeLinejoin: \"round\",\n          strokeWidth: 2,\n          d: \"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 526,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 524,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n        className: `text-sm ${isDark ? 'text-gray-400' : 'text-gray-500'}`,\n        children: \"You have view-only access to this document\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 528,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 523,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 362,\n    columnNumber: 5\n  }, this);\n};\n_s(CollaborativeEditor, \"yvluZl/0kaq0gOYOuNznpHkgn74=\", false, function () {\n  return [useParams, useNavigate, useTheme, useAutoSave, useSocket];\n});\n_c = CollaborativeEditor;\nexport default CollaborativeEditor;\nvar _c;\n$RefreshReg$(_c, \"CollaborativeEditor\");","map":{"version":3,"names":["React","useState","useEffect","useRef","useCallback","useContext","useParams","useNavigate","getDocument","updateDocument","useTheme","useAuth","useSocket","useAutoSave","CollaborativeTextElement","ImageElement","mergeTextContent","hasConflict","AuthContext","jsxDEV","_jsxDEV","colorPalette","getColorForUserId","userId","colors","hash","split","reduce","a","b","charCodeAt","Math","abs","length","CollaborativeEditor","documentId","isReadOnly","_s","id","paramId","navigate","isDark","authContext","user","loading","isAuthenticated","document","setDocument","title","content","isLoading","setIsLoading","connectedUsers","setConnectedUsers","isOnline","setIsOnline","lastSavedContent","setLastSavedContent","hasUnsavedChanges","setHasUnsavedChanges","userPermission","setUserPermission","debounceTimeoutRef","isRemoteChangeRef","remoteSelections","setRemoteSelections","canEdit","handleAutoSaveSuccess","forceSave","isSaving","console","log","_id","userName","name","username","email","userKeys","Object","keys","userIdAlt","userEmail","emitDocumentChange","emitCursorChange","onDocumentChange","onCursorChange","onUserJoined","onUserLeft","onUsersInDocument","offDocumentChange","offCursorChange","offUserJoined","offUserLeft","offUsersInDocument","isConnected","isMounted","fetchDocument","fetchedDocument","normalizedContent","Array","isArray","type","documentData","JSON","stringify","error","current","prevDoc","currentContent","remoteContent","warn","mergedContent","remoteUserId","remoteUserName","position","selection","_ref","_selection$index","_selection$length","currentUserId","color","index","prev","updatedAt","Date","now","exists","find","u","filter","copy","users","handleChange","updatedContent","clearTimeout","setTimeout","handleSave","alert","handleImageUpload","e","file","target","files","size","formData","FormData","append","res","fetch","method","body","data","json","imageUrl","newImageBlock","src","alt","className","children","fileName","_jsxFileName","lineNumber","columnNumber","onClick","map","accept","onChange","element","values","undefined","newContent","onSelectionChange","onDelete","_","i","disabled","fill","stroke","viewBox","strokeLinecap","strokeLinejoin","strokeWidth","d","_c","$RefreshReg$"],"sources":["D:/Docs-MERN/google-docs-clone/frontend/src/components/CollaborativeEditor.jsx"],"sourcesContent":["import React, { useState, useEffect, useRef, useCallback, useContext } from 'react';\r\nimport { useParams, useNavigate } from 'react-router-dom';\r\nimport { getDocument, updateDocument } from '../services/documentService';\r\nimport { useTheme } from '../contexts/ThemeContext';\r\nimport useAuth from '../hooks/useAuth';\r\nimport useSocket from '../hooks/useSocket';\r\nimport useAutoSave from '../hooks/useAutoSave';\r\nimport CollaborativeTextElement from './CollaborativeTextElement';\r\nimport ImageElement from './ImageElement';\r\nimport { mergeTextContent, hasConflict } from '../utils/conflictResolution';\r\nimport { AuthContext } from '../contexts/AuthContext';\r\n\r\nconst colorPalette = [\r\n  '#ef4444', '#f59e0b', '#10b981', '#3b82f6', '#8b5cf6', '#ec4899', '#14b8a6', '#f97316'\r\n];\r\n\r\nconst getColorForUserId = (userId) => {\r\n  const colors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7', '#DDA0DD', '#98D8C8'];\r\n  const hash = userId.split('').reduce((a, b) => {\r\n    a = ((a << 5) - a) + b.charCodeAt(0);\r\n    return a & a;\r\n  }, 0);\r\n  return colors[Math.abs(hash) % colors.length];\r\n};\r\n\r\nconst CollaborativeEditor = ({ documentId, isReadOnly = false }) => {\r\n  const { id: paramId } = useParams();\r\n  const id = documentId || paramId; // Use prop if provided, otherwise use param\r\n  const navigate = useNavigate();\r\n  const { isDark } = useTheme();\r\n  const authContext = useContext(AuthContext);\r\n  \r\n  // Use authContext.user instead of useAuth\r\n  const user = authContext.user;\r\n  const loading = !authContext.isAuthenticated; // or however you track loading in AuthContext\r\n  \r\n  const [document, setDocument] = useState({ title: '', content: [] });\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [connectedUsers, setConnectedUsers] = useState([]);\r\n  const [isOnline, setIsOnline] = useState(false);\r\n  const [lastSavedContent, setLastSavedContent] = useState(null);\r\n  const [hasUnsavedChanges, setHasUnsavedChanges] = useState(false);\r\n  const [userPermission, setUserPermission] = useState(null);\r\n  const debounceTimeoutRef = useRef(null);\r\n  const isRemoteChangeRef = useRef(false);\r\n  const [remoteSelections, setRemoteSelections] = useState({}); // userId -> { index, length, color, name }\r\n\r\n  // Auto-save hook - disable for viewers\r\n  const canEdit = userPermission === 'owner' || userPermission === 'editor';\r\n  \r\n  // Callback to reset unsaved changes when auto-save completes\r\n  const handleAutoSaveSuccess = useCallback(() => {\r\n    setHasUnsavedChanges(false);\r\n  }, []);\r\n  \r\n  const { forceSave, isSaving } = useAutoSave(id, document, isOnline && canEdit, handleAutoSaveSuccess);\r\n\r\n  useEffect(() => {\r\n    console.log('ðŸ” User state changed:', { \r\n      user, \r\n      userId: user?.id || user?._id, \r\n      userName: user?.name || user?.username || user?.email \r\n    });\r\n  }, [user]);\r\n\r\n  useEffect(() => {\r\n    console.log('ðŸ” Auth Debug:', { \r\n      user, \r\n      userKeys: user ? Object.keys(user) : 'no user',\r\n      userId: user?.id,\r\n      userIdAlt: user?._id,\r\n      userName: user?.name,\r\n      userEmail: user?.email\r\n    });\r\n  }, [user]);\r\n\r\n  useEffect(() => {\r\n    console.log('ðŸ” User loading state:', { user, loading, isAuthenticated: !!user });\r\n  }, [user, loading]);\r\n\r\n  useEffect(() => {\r\n    if (user) {\r\n      console.log('ðŸ” User object structure:', {\r\n        user,\r\n        keys: Object.keys(user),\r\n        id: user.id,\r\n        _id: user._id,\r\n        userId: user.userId,\r\n        name: user.name,\r\n        username: user.username,\r\n        email: user.email\r\n      });\r\n    }\r\n  }, [user]);\r\n\r\n  //Socket connection\r\n  const {\r\n    emitDocumentChange,\r\n    emitCursorChange,\r\n    onDocumentChange,\r\n    onCursorChange,\r\n    onUserJoined,\r\n    onUserLeft,\r\n    onUsersInDocument,\r\n    offDocumentChange,\r\n    offCursorChange,\r\n    offUserJoined,\r\n    offUserLeft,\r\n    offUsersInDocument,\r\n    isConnected,\r\n  } = useSocket(\r\n    id, \r\n    user?.id || user?._id,\r\n    user?.name || user?.username || user?.email || 'Anonymous'\r\n  );\r\n\r\n  console.log('ðŸ”— Socket status:', { \r\n    isConnected, \r\n    userId: user?.id || user?._id, \r\n    documentId: id,\r\n    user: user\r\n  });\r\n\r\n  \r\n useEffect(() => {\r\n    let isMounted = true;\r\n    const fetchDocument = async () => {\r\n      try {\r\n        const fetchedDocument = await getDocument(id);\r\n\r\n        // Normalize content\r\n        const normalizedContent = Array.isArray(fetchedDocument.content)\r\n          ? fetchedDocument.content\r\n          : [{ type: 'text', content: fetchedDocument.content || '' }];\r\n\r\n        const documentData = {\r\n          title: fetchedDocument.title || '',\r\n          content: normalizedContent,\r\n        };\r\n\r\n        if (!isMounted) return;\r\n        setDocument(documentData);\r\n        setLastSavedContent(JSON.stringify(documentData));\r\n        setUserPermission(fetchedDocument.userPermission);\r\n\r\n\r\n        if (!isMounted) return;\r\n        setIsOnline(true);\r\n      } catch (error) {\r\n        console.error('Error fetching document:', error);\r\n        if (!isMounted) return;\r\n        setIsOnline(false);\r\n      } finally {\r\n        if (!isMounted) return;\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchDocument();\r\n    return () => { isMounted = false; };\r\n  }, [id]);\r\n\r\n  // Set up socket event listeners\r\n  useEffect(() => {\r\n    if (!user) return;\r\n\r\n    // Handle document changes from other sessions (including same user in another tab)\r\n    onDocumentChange(({ content, userId, userName }) => {\r\n\r\n      isRemoteChangeRef.current = true;\r\n\r\n      setDocument((prevDoc) => {\r\n        // Check for conflicts\r\n        const currentContent = JSON.stringify(prevDoc.content);\r\n        const remoteContent = JSON.stringify(content);\r\n\r\n      if (hasConflict(currentContent, remoteContent, lastSavedContent)) {\r\n      console.warn('Conflict detected - merging changes');\r\n      \r\n      // Better conflict resolution\r\n      const mergedContent = mergeTextContent(\r\n        prevDoc.content, \r\n        content, \r\n        lastSavedContent\r\n      );\r\n      \r\n      return { ...prevDoc, content: mergedContent };\r\n    }\r\n\r\n        return { ...prevDoc, content };\r\n      });\r\n\r\n\r\n    });\r\n\r\n    // Remote cursor/selection updates\r\n    onCursorChange(({ userId: remoteUserId, userName: remoteUserName, position, selection }) => {\r\n      console.log('ðŸ“¥ Received cursor change:', { \r\n        remoteUserId, \r\n        remoteUserName, \r\n        position, \r\n        selection,\r\n        currentUserId: user?.id || user?._id\r\n      });\r\n      \r\n      if (!remoteUserId || (remoteUserId === (user?.id || user?._id))) {\r\n        console.log('âŒ Ignoring cursor change - same user or no userId');\r\n        return;\r\n      }\r\n      \r\n      const color = getColorForUserId(remoteUserId);\r\n      const index = selection?.index ?? position ?? 0;\r\n      const length = selection?.length ?? 0;\r\n      \r\n      console.log('âœ… Setting remote selection:', { remoteUserId, index, length, color });\r\n      \r\n      setRemoteSelections((prev) => ({\r\n        ...prev,\r\n        [remoteUserId]: {\r\n          userId: remoteUserId,\r\n          name: remoteUserName,\r\n          color,\r\n          index,\r\n          length,\r\n          updatedAt: Date.now(),\r\n        }\r\n      }));\r\n    });\r\n\r\n    // Handle user presence\r\n    onUserJoined(({ userId, userName }) => {\r\n      setConnectedUsers((prev) => {\r\n        const exists = prev.find((u) => u.userId === userId);\r\n        if (!exists) {\r\n          return [...prev, { userId, userName }];\r\n        }\r\n        return prev;\r\n      });\r\n\r\n    });\r\n\r\n    onUserLeft(({ userId, userName }) => {\r\n      setConnectedUsers((prev) => prev.filter((u) => u.userId !== userId));\r\n      setRemoteSelections((prev) => {\r\n        const copy = { ...prev };\r\n        delete copy[userId];\r\n        return copy;\r\n      });\r\n    });\r\n\r\n    onUsersInDocument((users) => {\r\n      setConnectedUsers(users.filter((u) => u.userId !== (user?.id || user?._id)));\r\n    });\r\n\r\n    // Cleanup\r\n    return () => {\r\n      offDocumentChange();\r\n      offCursorChange();\r\n      offUserJoined();\r\n      offUserLeft();\r\n      offUsersInDocument();\r\n    };\r\n  }, [user, onDocumentChange, onCursorChange, onUserJoined, onUserLeft, onUsersInDocument, offDocumentChange, offCursorChange, offUserJoined, offUserLeft, offUsersInDocument]);\r\n\r\n  const handleChange = (updatedContent) => {\r\n    // Prevent viewers from making changes\r\n    if (userPermission === 'viewer') {\r\n      console.log('Viewers cannot edit documents');\r\n      return;\r\n    }\r\n\r\n    setDocument((prevDoc) => ({ ...prevDoc, content: updatedContent }));\r\n    setHasUnsavedChanges(true);\r\n\r\n    // Don't emit changes if this was triggered by a remote change\r\n    if (isRemoteChangeRef.current) {\r\n      isRemoteChangeRef.current = false;\r\n      return;\r\n    }\r\n\r\n    // Debounce socket emissions to avoid spam\r\n    if (debounceTimeoutRef.current) {\r\n      clearTimeout(debounceTimeoutRef.current);\r\n    }\r\n\r\n    debounceTimeoutRef.current = setTimeout(() => {\r\n\r\n      emitDocumentChange(null, updatedContent);\r\n    }, 300);\r\n  };\r\n\r\n  const handleSave = async () => {\r\n    // Prevent viewers from saving\r\n    if (userPermission === 'viewer') {\r\n      alert('Viewers cannot save documents');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      await forceSave();\r\n      setLastSavedContent(JSON.stringify(document));\r\n      setHasUnsavedChanges(false);\r\n      alert('Document saved successfully!');\r\n    } catch (error) {\r\n      console.error('Error saving document:', error);\r\n      alert('Error saving document');\r\n    }\r\n  };\r\n\r\n  const handleImageUpload = async (e) => {\r\n    // Prevent viewers from uploading images\r\n    if (userPermission === 'viewer') {\r\n      alert('Viewers cannot upload images');\r\n      return;\r\n    }\r\n\r\n    const file = e.target.files[0];\r\n    if (!file) return;\r\n\r\n    // Optional: check file size limit (e.g., 5MB)\r\n    if (file.size > 5 * 1024 * 1024) {\r\n      alert('Image is too large (max 5MB)');\r\n      return;\r\n    }\r\n\r\n    const formData = new FormData();\r\n    formData.append('image', file);\r\n\r\n    try {\r\n      const res = await fetch('http://localhost:5000/api/upload-image', {\r\n        method: 'POST',\r\n        body: formData,\r\n      });\r\n\r\n      const data = await res.json();\r\n\r\n      if (data.imageUrl) {\r\n        const newImageBlock = {\r\n          type: 'image',\r\n          src: data.imageUrl,\r\n          alt: file.name,\r\n        };\r\n\r\n        const updatedContent = [...document.content, newImageBlock];\r\n        handleChange(updatedContent);\r\n      } else {\r\n        alert('Upload failed. Try again.');\r\n      }\r\n    } catch (error) {\r\n      console.error('Upload error:', error);\r\n      alert('Something went wrong during upload.');\r\n    }\r\n  };\r\n\r\n  if (isLoading) return (\r\n    <div className={`flex items-center justify-center min-h-screen ${isDark ? 'text-white' : 'text-gray-800'}`}>\r\n      Loading...\r\n    </div>\r\n  );\r\n\r\n  return (\r\n    <div className={`p-6 max-w-4xl mx-auto ${isDark ? 'text-white' : 'text-gray-800'}`}>\r\n      {/* Header with title and status */}\r\n      <div className=\"flex justify-between items-center mb-4\">\r\n        <div>\r\n          <h1 className={`text-2xl font-bold ${isDark ? 'text-white' : 'text-gray-800'}`}>\r\n            {document.title || 'Untitled Document'}\r\n          </h1>\r\n          <div className=\"flex items-center mt-2 space-x-4\">\r\n            <div className={`flex items-center space-x-2 ${isConnected ? 'text-green-500' : 'text-red-500'}`}>\r\n              <div className={`w-2 h-2 rounded-full ${isConnected ? 'bg-green-500' : 'bg-red-500'}`}></div>\r\n              <span className=\"text-sm\">{isConnected ? 'Connected' : 'Disconnected'}</span>\r\n            </div>\r\n            <div className=\"text-sm text-gray-500\">\r\n              User: {user?.name || user?.username || user?.email || 'Not logged in'}\r\n            </div>\r\n            <div className=\"text-sm text-gray-500\">\r\n              ID: {user?.id || user?._id || 'No ID'}\r\n            </div>\r\n            <div className={`flex items-center space-x-2 text-sm ${\r\n              isSaving ? 'text-blue-500' : \r\n              hasUnsavedChanges ? 'text-yellow-500' : 'text-green-500'\r\n            }`}>\r\n              <div className={`w-2 h-2 rounded-full ${\r\n                isSaving ? 'bg-blue-500 animate-pulse' : \r\n                hasUnsavedChanges ? 'bg-yellow-500' : 'bg-green-500'\r\n              }`}></div>\r\n              <span>\r\n                {isSaving ? 'Saving...' : \r\n                 hasUnsavedChanges ? 'Unsaved changes' : 'All changes saved'}\r\n              </span>\r\n            </div>\r\n            {connectedUsers.length > 0 && (\r\n              <div className={`text-sm ${isDark ? 'text-gray-300' : 'text-gray-600'}`}>\r\n                {connectedUsers.length} other{connectedUsers.length === 1 ? ' user' : ' users'} editing\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n        <button\r\n          onClick={() => navigate('/documents')}\r\n          className={`text-sm px-3 py-1 rounded transition-colors duration-200 ${\r\n            isDark \r\n              ? 'bg-gray-700 hover:bg-gray-600 text-white' \r\n              : 'bg-gray-300 hover:bg-gray-400 text-gray-800'\r\n          }`}\r\n        >\r\n          Back to List\r\n        </button>\r\n      </div>\r\n\r\n      {/* Connected Users */}\r\n      {connectedUsers.length > 0 && (\r\n        <div className={`mb-4 p-3 rounded ${isDark ? 'bg-gray-800 border border-gray-700' : 'bg-blue-50 border border-blue-200'}`}>\r\n          <div className={`text-sm font-semibold mb-2 ${isDark ? 'text-white' : 'text-gray-800'}`}>\r\n            Currently editing:\r\n          </div>\r\n          <div className=\"flex flex-wrap gap-2\">\r\n            {connectedUsers.map((user) => (\r\n              <span\r\n                key={user.userId}\r\n                className={`px-2 py-1 text-xs rounded-full ${\r\n                  isDark \r\n                    ? 'bg-blue-600 text-white' \r\n                    : 'bg-blue-100 text-blue-800'\r\n                }`}\r\n              >\r\n                {user.userName}\r\n              </span>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Image Upload */}\r\n      {/* Upload Image Section - only show if not read-only */}\r\n      {!isReadOnly && (\r\n        <div className={`mb-4 p-4 rounded ${isDark ? 'bg-gray-800 border border-gray-700' : 'bg-gray-50 border border-gray-200'}`}>\r\n          <label className={`block font-semibold mb-1 ${isDark ? 'text-white' : 'text-gray-800'}`}>Add Image</label>\r\n          <input \r\n            type=\"file\" \r\n            accept=\"image/*\" \r\n            onChange={handleImageUpload}\r\n            className={`block w-full text-sm ${\r\n              isDark \r\n                ? 'text-gray-300 file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-semibold file:bg-gray-700 file:text-white hover:file:bg-gray-600' \r\n                : 'text-gray-700 file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100'\r\n            }`}\r\n          />\r\n        </div>\r\n      )}\r\n\r\n      {/* Document Content */}\r\n      <div className=\"space-y-4\">\r\n        {document.content.map((element, index) => {\r\n          if (element.type === 'text') {\r\n            return (\r\n              <CollaborativeTextElement\r\n                key={index}\r\n                content={element.content}\r\n                isReadOnly={isReadOnly}\r\n                user={user}\r\n                remoteSelections={Object.values(remoteSelections)}\r\n                onChange={isReadOnly ? undefined : (newContent) => {\r\n                  const updatedContent = [...document.content];\r\n                  updatedContent[index].content = newContent;\r\n                  handleChange(updatedContent);\r\n                }}\r\n                onSelectionChange={(selection) => {\r\n                  console.log('About to emit cursor change:', { \r\n                    selection, \r\n                    isReadOnly, \r\n                    isConnected, \r\n                    userId: user?.id || user?._id \r\n                  });\r\n                  if (!isReadOnly && selection && isConnected) {\r\n                    emitCursorChange(selection.index, selection);\r\n                  } else {\r\n                    console.log('Not emitting cursor change - conditions not met');\r\n                  }\r\n                }}\r\n              />\r\n            );\r\n          } else if (element.type === 'image') {\r\n            return (\r\n              <ImageElement\r\n                key={index}\r\n                src={element.src}\r\n                alt={element.alt}\r\n                onDelete={() => {\r\n                  const updatedContent = document.content.filter((_, i) => i !== index);\r\n                  handleChange(updatedContent);\r\n                }}\r\n              />\r\n            );\r\n          }\r\n          return null;\r\n        })}\r\n      </div>\r\n\r\n      {/* Save Button - only show if not read-only */}\r\n      {!isReadOnly && (\r\n        <div className=\"mt-6 flex items-center space-x-4\">\r\n          <button\r\n            onClick={handleSave}\r\n            disabled={isSaving}\r\n            className={`px-4 py-2 rounded transition-colors duration-200 ${\r\n              isSaving \r\n                ? 'bg-gray-400 cursor-not-allowed' \r\n                : 'bg-blue-500 hover:bg-blue-600'\r\n            } text-white`}\r\n          >\r\n            {isSaving ? 'Saving...' : 'Save Now'}\r\n          </button>\r\n          <span className={`text-sm ${isDark ? 'text-gray-400' : 'text-gray-500'}`}>\r\n            Changes are auto-saved every 2 seconds\r\n          </span>\r\n        </div>\r\n      )}\r\n      \r\n      {/* Read-only indicator */}\r\n      {isReadOnly && (\r\n        <div className=\"mt-6 flex items-center space-x-2\">\r\n          <svg className=\"w-5 h-5 text-blue-500\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\" />\r\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z\" />\r\n          </svg>\r\n          <span className={`text-sm ${isDark ? 'text-gray-400' : 'text-gray-500'}`}>\r\n            You have view-only access to this document\r\n          </span>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default CollaborativeEditor;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}